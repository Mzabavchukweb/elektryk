function initHeader(){const e=document.querySelector(".header");e&&window.addEventListener("scroll",()=>{e.classList.toggle("header-scrolled",window.pageYOffset>50)},{passive:!0})}function initMobileNav(){const e=document.querySelector(".menu-toggle"),t=document.querySelector(".mobile-nav");if(!e||!t)return;const n=document.querySelector(".mobile-nav-close"),o=()=>{t.classList.remove("active"),document.body.style.overflow="",e.setAttribute("aria-expanded","false")};e.addEventListener("click",()=>{t.classList.add("active"),document.body.style.overflow="hidden",e.setAttribute("aria-expanded","true")}),n?.addEventListener("click",o),t.addEventListener("click",e=>{e.target.classList.contains("mobile-nav-link")&&o()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&t.classList.contains("active")&&o()})}function initScrollAnimations(){const e=document.querySelectorAll(".animate-on-scroll");if(!e.length)return;const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("animated"),e.target.classList.contains("stagger-children")&&Array.from(e.target.children).forEach((e,t)=>{e.style.transitionDelay=100*t+"ms"}))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});e.forEach(e=>t.observe(e))}function initCableTimeline(){const e=document.querySelector(".cable-timeline");if(!e)return;const t=e.querySelector(".cable-container"),n=e.querySelector(".cable-fill"),o=e.querySelectorAll(".cable-marker"),i=e.querySelector(".cable-progress");let r,a=0,s=0,c=!1,l=!1;const d=Array.from({length:3},()=>{const e=document.createElement("div");return e.className="cable-spark",e.style.cssText="position:absolute;width:40px;height:40px;left:50%;transform:translateX(-50%);pointer-events:none;opacity:0;z-index:10",t?.appendChild(e),e});function u(){const e=document.documentElement.scrollHeight-window.innerHeight,t=window.pageYOffset,r=e>0?Math.min(Math.max(t/e,0),1):0,d=Math.round(100*r);n&&(n.style.height=`${d}%`),i&&(i.textContent=`${d}%`);Math.abs(t-s)>5&&!l&&(m(d),l=!0,setTimeout(()=>{l=!1},100)),s=t,a=r,function(){const e=.4*window.innerHeight;o.forEach(t=>{const n=document.querySelector(t.dataset.target);if(!n)return;const o=n.getBoundingClientRect();t.classList.remove("active","current"),o.bottom<e?t.classList.add("active"):o.top<e&&o.bottom>e&&t.classList.add("current")})}(),c=!1}function m(e){const n=d[Math.floor(Math.random()*d.length)];n&&(n.style.top=`${Math.min(e,95)+10*(Math.random()-.5)}%`,n.classList.remove("active"),n.offsetWidth,n.classList.add("active"),function(e){if(!t)return;for(let n=0;n<4;n++){const o=document.createElement("div"),i=n/4*Math.PI*2,r=20+15*Math.random();o.style.cssText=`position:absolute;width:4px;height:4px;background:#fff;border-radius:50%;top:${parseFloat(e.style.top)}%;left:50%;transform:translateX(-50%);pointer-events:none;z-index:15;box-shadow:0 0 6px #F59E0B,0 0 12px #F59E0B`,t.appendChild(o),o.animate([{opacity:1,transform:"translate(-50%,-50%) translate(0,0) scale(1)"},{opacity:0,transform:`translate(-50%,-50%) translate(${Math.cos(i)*r}px,${Math.sin(i)*r}px) scale(0)`}],{duration:400+200*Math.random(),easing:"cubic-bezier(0,0,0.2,1)"}).onfinish=()=>o.remove()}}(n),setTimeout(()=>n.classList.remove("active"),600))}const h=()=>{a>.05&&a<.95&&m(Math.round(100*a)),r=setTimeout(h,2e3+2e3*Math.random())};window.addEventListener("scroll",()=>{c||(requestAnimationFrame(u),c=!0),clearTimeout(r),r=setTimeout(h,3e3)},{passive:!0}),e.addEventListener("click",e=>{const t=e.target.closest(".cable-marker");if(!t)return;const n=document.querySelector(t.dataset.target);if(!n)return;const o=document.querySelector(".header")?.offsetHeight||0;window.scrollTo({top:n.offsetTop-o-20,behavior:"smooth"})}),u(),r=setTimeout(h,3e3)}function initForms(){document.querySelectorAll("form").forEach(e=>{e.addEventListener("focusin",e=>{e.target.matches(".form-input")&&e.target.parentElement?.classList.add("focused")}),e.addEventListener("focusout",e=>{e.target.matches(".form-input")&&(e.target.parentElement?.classList.remove("focused"),e.target.parentElement?.classList.toggle("filled",!!e.target.value))}),e.addEventListener("input",e=>{"tel"===e.target.type&&formatPhone(e)}),e.addEventListener("submit",async t=>{t.preventDefault();const n=e.querySelector('button[type="submit"]');if(!n)return;const o=n.querySelector(".btn-text")?.textContent||n.textContent,i=new FormData(e);n.querySelector(".btn-text")?n.querySelector(".btn-text").textContent="Wysyłanie...":n.textContent="Wysyłanie...",n.disabled=!0;try{const e=await fetch("https://api.web3forms.com/submit",{method:"POST",body:i}),t=await e.json();e.ok&&t.success?window.location.href="thank-you.html":(alert("Wystąpił błąd podczas wysyłania formularza. Spróbuj ponownie lub skontaktuj się telefonicznie: 669 899 443"),console.error("Web3Forms error:",t))}catch(e){alert("Nie udało się wysłać formularza. Sprawdź połączenie internetowe i spróbuj ponownie."),console.error("Form submission error:",e)}finally{n.querySelector(".btn-text")?n.querySelector(".btn-text").textContent=o:n.textContent=o,n.disabled=!1}})})}function formatPhone(e){let t=e.target.value.replace(/\D/g,"").slice(0,9);t.length>6?t=`${t.slice(0,3)} ${t.slice(3,6)} ${t.slice(6)}`:t.length>3&&(t=`${t.slice(0,3)} ${t.slice(3)}`),e.target.value=t}function initParticles(){const e=document.querySelector(".particles-container");if(e&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches)for(let t=0;t<12;t++){const t=document.createElement("div");t.className="particle";const n=1+2*Math.random();t.style.cssText=`width:${n}px;height:${n}px;left:${100*Math.random()}%;animation-delay:${10*Math.random()}s;animation-duration:${8+6*Math.random()}s`,e.appendChild(t)}}function initSmoothScroll(){document.addEventListener("click",e=>{const t=e.target.closest('a[href^="#"]');if(!t)return;const n=t.getAttribute("href");if("#"===n)return;const o=document.querySelector(n);if(!o)return;e.preventDefault();const i=parseInt(getComputedStyle(document.documentElement).scrollPaddingTop)||180;window.scrollTo({top:Math.max(0,o.offsetTop-i),behavior:"smooth"})})}function initActivePageHighlight(){const e=window.location.pathname;document.querySelectorAll(".nav-link, .mobile-nav-link").forEach(t=>{const n=t.getAttribute("href"),o=e.endsWith(n)||"/"===e&&"index.html"===n||e.endsWith("/")&&"index.html"===n;t.classList.toggle("active",o)})}function initCityPrefill(){const e=new URLSearchParams(window.location.search).get("miasto");if(!e)return;const t={"gorzow-wielkopolski":"Gorzów Wielkopolski","kostrzyn-nad-odra":"Kostrzyn nad Odrą","strzelce-krajenskie":"Strzelce Krajeńskie",miedzyrzecz:"Międzyrzecz",sulecin:"Sulęcin",skwierzyna:"Skwierzyna",debno:"Dębno",mysliborz:"Myślibórz",drezdenko:"Drezdenko",witnica:"Witnica",slubice:"Słubice",rzepin:"Rzepin"}[e];if(!t)return;const n=`Miasto: ${t}`;[document.querySelector('input[name="subject"]'),document.querySelector('textarea[name="message"], textarea[name="wiadomosc"]')].filter(Boolean).forEach(e=>{e.value.startsWith("Miasto:")||(e.value=e.value.trim()?`${n}\n${e.value.trim()}`:n)})}document.addEventListener("DOMContentLoaded",()=>{initHeader(),initMobileNav(),initScrollAnimations(),initCableTimeline(),initForms(),initParticles(),initCityPrefill(),initSmoothScroll(),initActivePageHighlight()});