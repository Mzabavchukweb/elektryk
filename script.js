function initHeader(){const e=document.querySelector(".header");e&&window.addEventListener("scroll",()=>{e.classList.toggle("header-scrolled",window.pageYOffset>50)},{passive:!0})}function initMobileNav(){const e=document.querySelector(".menu-toggle"),t=document.querySelector(".mobile-nav");if(!e||!t)return;const n=document.querySelector(".mobile-nav-close"),r=()=>{t.classList.remove("active"),document.body.style.overflow="",e.setAttribute("aria-expanded","false")};e.addEventListener("click",()=>{t.classList.add("active"),document.body.style.overflow="hidden",e.setAttribute("aria-expanded","true")}),n?.addEventListener("click",r),t.addEventListener("click",e=>{e.target.classList.contains("mobile-nav-link")&&r()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&t.classList.contains("active")&&r()})}function initScrollAnimations(){const e=document.querySelectorAll(".animate-on-scroll");if(!e.length)return;const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("animated"),e.target.classList.contains("stagger-children")&&Array.from(e.target.children).forEach((e,t)=>{e.style.transitionDelay=100*t+"ms"}))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});e.forEach(e=>t.observe(e))}function initCableTimeline(){const e=document.querySelector(".cable-timeline");if(!e)return;const t=e.querySelector(".cable-container"),n=e.querySelector(".cable-fill"),r=e.querySelectorAll(".cable-marker"),o=e.querySelector(".cable-progress");let a,i=0,s=0,c=!1,l=!1;const d=Array.from({length:3},()=>{const e=document.createElement("div");return e.className="cable-spark",e.style.cssText="position:absolute;width:40px;height:40px;left:50%;transform:translateX(-50%);pointer-events:none;opacity:0;z-index:10",t?.appendChild(e),e});function u(){const e=document.documentElement.scrollHeight-window.innerHeight,t=window.pageYOffset,a=e>0?Math.min(Math.max(t/e,0),1):0,d=Math.round(100*a);n&&(n.style.height=`${d}%`),o&&(o.textContent=`${d}%`);Math.abs(t-s)>5&&!l&&(m(d),l=!0,setTimeout(()=>{l=!1},100)),s=t,i=a,function(){const e=.4*window.innerHeight;r.forEach(t=>{const n=document.querySelector(t.dataset.target);if(!n)return;const r=n.getBoundingClientRect();t.classList.remove("active","current"),r.bottom<e?t.classList.add("active"):r.top<e&&r.bottom>e&&t.classList.add("current")})}(),c=!1}function m(e){const n=d[Math.floor(Math.random()*d.length)];n&&(n.style.top=`${Math.min(e,95)+10*(Math.random()-.5)}%`,n.classList.remove("active"),n.offsetWidth,n.classList.add("active"),function(e){if(!t)return;for(let n=0;n<4;n++){const r=document.createElement("div"),o=n/4*Math.PI*2,a=20+15*Math.random();r.style.cssText=`position:absolute;width:4px;height:4px;background:#fff;border-radius:50%;top:${parseFloat(e.style.top)}%;left:50%;transform:translateX(-50%);pointer-events:none;z-index:15;box-shadow:0 0 6px #F59E0B,0 0 12px #F59E0B`,t.appendChild(r),r.animate([{opacity:1,transform:"translate(-50%,-50%) translate(0,0) scale(1)"},{opacity:0,transform:`translate(-50%,-50%) translate(${Math.cos(o)*a}px,${Math.sin(o)*a}px) scale(0)`}],{duration:400+200*Math.random(),easing:"cubic-bezier(0,0,0.2,1)"}).onfinish=()=>r.remove()}}(n),setTimeout(()=>n.classList.remove("active"),600))}const f=()=>{i>.05&&i<.95&&m(Math.round(100*i)),a=setTimeout(f,2e3+2e3*Math.random())};window.addEventListener("scroll",()=>{c||(requestAnimationFrame(u),c=!0),clearTimeout(a),a=setTimeout(f,3e3)},{passive:!0}),e.addEventListener("click",e=>{const t=e.target.closest(".cable-marker");if(!t)return;const n=document.querySelector(t.dataset.target);if(!n)return;const r=document.querySelector(".header")?.offsetHeight||0;window.scrollTo({top:n.offsetTop-r-20,behavior:"smooth"})}),u(),a=setTimeout(f,3e3)}function initForms(){document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",handleSubmit),e.addEventListener("focusin",e=>{e.target.matches(".form-input")&&e.target.parentElement?.classList.add("focused")}),e.addEventListener("focusout",e=>{e.target.matches(".form-input")&&(e.target.parentElement?.classList.remove("focused"),e.target.parentElement?.classList.toggle("filled",!!e.target.value))}),e.addEventListener("input",e=>{"tel"===e.target.type&&formatPhone(e)})})}function handleSubmit(e){e.preventDefault();const t=e.target,n=t.querySelector('button[type="submit"]');if(!n||!validateForm(t))return;const r=n.innerHTML;n.classList.add("btn-loading"),n.innerHTML='<span class="btn-text" style="opacity:0">Wysyłanie</span>',n.disabled=!0,setTimeout(()=>{n.classList.remove("btn-loading"),n.innerHTML=r,n.disabled=!1,showMessage(t,"success","Dziękujemy! Skontaktujemy się wkrótce."),t.reset()},1500)}function validateForm(e){let t=!0;e.querySelectorAll(".form-input").forEach(e=>{clearError(e),e.required&&!e.value.trim()?(showError(e,"To pole jest wymagane"),t=!1):"email"===e.type&&e.value&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value)?(showError(e,"Podaj prawidłowy adres e-mail"),t=!1):"tel"===e.type&&e.value&&e.value.replace(/\D/g,"").length<9&&(showError(e,"Podaj prawidłowy numer telefonu"),t=!1)});const n=e.querySelector('input[name="privacy"]');return n&&!n.checked&&(showMessage(e,"error","Musisz zaakceptować politykę prywatności"),t=!1),t}function showError(e,t){e.classList.add("form-input-error");const n=document.createElement("span");n.className="form-error-message",n.innerHTML=`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>${t}`,e.parentElement?.appendChild(n)}function clearError(e){e.classList.remove("form-input-error"),e.parentElement?.querySelector(".form-error-message")?.remove()}function showMessage(e,t,n){e.querySelector(".form-message")?.remove();const r=document.createElement("div");r.className=`form-message form-message-${t}`,r.style.cssText=`grid-column:1/-1;padding:var(--space-4);border-radius:var(--radius-md);font-size:var(--text-sm);font-weight:var(--font-medium);text-align:center;margin-bottom:var(--space-4);background:${"success"===t?"rgba(34,197,94,0.1)":"rgba(239,68,68,0.1)"};color:${"success"===t?"var(--success-500)":"var(--error-500)"};border:1px solid ${"success"===t?"rgba(34,197,94,0.2)":"rgba(239,68,68,0.2)"}`,r.textContent=n,e.insertBefore(r,e.firstChild),"success"===t&&setTimeout(()=>r.remove(),5e3)}function formatPhone(e){let t=e.target.value.replace(/\D/g,"").slice(0,9);t.length>6?t=`${t.slice(0,3)} ${t.slice(3,6)} ${t.slice(6)}`:t.length>3&&(t=`${t.slice(0,3)} ${t.slice(3)}`),e.target.value=t}function initParticles(){const e=document.querySelector(".particles-container");if(e&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches)for(let t=0;t<12;t++){const t=document.createElement("div");t.className="particle";const n=1+2*Math.random();t.style.cssText=`width:${n}px;height:${n}px;left:${100*Math.random()}%;animation-delay:${10*Math.random()}s;animation-duration:${8+6*Math.random()}s`,e.appendChild(t)}}function initSmoothScroll(){document.addEventListener("click",e=>{const t=e.target.closest('a[href^="#"]');if(!t)return;const n=t.getAttribute("href");if("#"===n)return;const r=document.querySelector(n);if(!r)return;e.preventDefault();const o=parseInt(getComputedStyle(document.documentElement).scrollPaddingTop)||180;window.scrollTo({top:Math.max(0,r.offsetTop-o),behavior:"smooth"})})}function initActivePageHighlight(){const e=window.location.pathname;document.querySelectorAll(".nav-link, .mobile-nav-link").forEach(t=>{const n=t.getAttribute("href"),r=e.endsWith(n)||"/"===e&&"index.html"===n||e.endsWith("/")&&"index.html"===n;t.classList.toggle("active",r)})}function initCityPrefill(){const e=new URLSearchParams(window.location.search).get("miasto");if(!e)return;const t={"gorzow-wielkopolski":"Gorzów Wielkopolski","kostrzyn-nad-odra":"Kostrzyn nad Odrą","strzelce-krajenskie":"Strzelce Krajeńskie",miedzyrzecz:"Międzyrzecz",sulecin:"Sulęcin",skwierzyna:"Skwierzyna",debno:"Dębno",mysliborz:"Myślibórz",drezdenko:"Drezdenko",witnica:"Witnica",slubice:"Słubice",rzepin:"Rzepin"}[e];if(!t)return;const n=`Miasto: ${t}`;[document.querySelector('input[name="subject"]'),document.querySelector('textarea[name="message"], textarea[name="wiadomosc"]')].filter(Boolean).forEach(e=>{e.value.startsWith("Miasto:")||(e.value=e.value.trim()?`${n}\n${e.value.trim()}`:n)})}document.addEventListener("DOMContentLoaded",()=>{initHeader(),initMobileNav(),initScrollAnimations(),initCableTimeline(),initForms(),initParticles(),initCityPrefill(),initSmoothScroll(),initActivePageHighlight()});